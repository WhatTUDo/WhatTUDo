<div class="contextual-control">
  <span id="back-button"><a class="clickable no-hover-enlarge" href="/"><fa-icon
    [icon]="faChevronLeft"></fa-icon>&ensp;Back</a></span>
</div>
<div class="centered-two-third">
  <div class="title-icon-button-combo">
    <h2>Calendars</h2>
    <div *ngIf="authService.isLoggedIn()" class="icon-button clickable no-hover-enlarge">
      <fa-icon [icon]="faPlus" routerLink="/form/calendar"></fa-icon>
    </div>
  </div>
  <div *ngIf="loading">
    <h3>
      <fa-icon [icon]="faCircleNotch" [spin]="true"></fa-icon>
      Loadingâ€¦
    </h3>
  </div>
  <div *ngIf="!loading">
    <form (ngSubmit)="onSubmitSearch()" [formGroup]="searchForm" class="filter input-button-combo">
      <label for="calendar.name"></label>
      <input class="form-control" formControlName="name" id="calendar.name" value=""
             type="text">
      <button type="reset" *ngIf="searchActive" (click)="clearSearch()"
              class="button-red no-hover-enlarge flat-right-side">Clear
      </button>
      <button type="submit" class="no-hover-enlarge">Filter</button>
    </form>
    <div *ngIf="searchActive">
      <div *ngFor="let cal of this.calendarSearchResult">
        <div class="calendar">
          <img [ngClass]="getCalendarColor(cal.id)" alt="" class="avatar avatar-medium"
               src="{{globals.backendUri+cal.coverImageUrl}}">
          <div class="calendar-details clickable no-hover-enlarge" routerLink="/calendar/{{cal.id}}">
            <div>
              <div class="calendar-name">{{cal.name}}</div>
              <div class="calendar-description">{{cal.description}}</div>
            </div>
            <div>
              <div *ngFor="let orgId of cal.organizationIds">
                <div *ngIf="organizationsMap.get(orgId)" class="organization-info clickable no-hover-enlarge" routerLink="/organization/{{orgId}}">
                  <img alt="" class="avatar avatar-ultra-small" src="{{organizationsMap.get(orgId).coverImageUrl}}">
                  <div class="organization-name">{{organizationsMap.get(orgId).name}}</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="calendar-buttons">
          <fa-icon (click)="onClickUnsubscribe(cal.id)" *ngIf="authService.isLoggedIn() && isSubscribed(cal.id)"
                   [icon]="faBookmark"
                   class="subscribed clickable no-hover-enlarge">Unsubscribe
          </fa-icon>
          <fa-icon (click)="onClickSubscribe(cal.id)" *ngIf="authService.isLoggedIn()  && !isSubscribed(cal.id)"
                   [icon]="faBookmark"
                   class="clickable no-hover-enlarge">Subscribe
          </fa-icon>
          <fa-icon *ngIf="cal.canEdit" [icon]="faCog" class="clickable no-hover-enlarge"
                   routerLink="/form/calendar/{{cal.id}}">
            Edit Calendar
          </fa-icon>
          <fa-icon *ngIf="cal.canEdit" (click)="delete(cal.id)" [icon]="faTimesCircle"
                   class="clickable no-hover-enlarge">
            Remove Calendar
          </fa-icon>
        </div>
      </div>
    </div>
    <div *ngIf="authService.isLoggedIn() && !searchActive">
      <div class="title-icon-button-combo">
        <h3>My Calendars</h3>
        <div class="icon-button clickable no-hover-enlarge">
          <fa-icon [icon]="faLink" (click)="copyPersonalUrlToClipboard()"></fa-icon>
        </div>
      </div>
      <div *ngIf="subscribedCalendars.length===0">You have no subscribed calenders yet.</div>
      <div *ngFor="let cal of this.subscribedCalendars" class="calendar clickable no-hover-enlarge">
        <div class="calendar">
          <img [ngClass]="getCalendarColor(cal.id)" alt="" class="avatar avatar-medium"
               src="{{globals.backendUri+cal.coverImageUrl}}">
          <div class="calendar-details clickable no-hover-enlarge" routerLink="/calendar/{{cal.id}}">
            <div>
              <div class="calendar-name">{{cal.name}}</div>
              <div class="calendar-description">{{cal.description}}</div>
            </div>
            <div>
              <div *ngFor="let orgId of cal.organizationIds">
                <div *ngIf="organizationsMap.get(orgId)" class="organization-info clickable no-hover-enlarge" routerLink="/organization/{{orgId}}">
                  <img alt="" class="avatar avatar-ultra-small" src="{{organizationsMap.get(orgId).coverImageUrl}}">
                  <div class="organization-name">{{organizationsMap.get(orgId).name}}</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="calendar-buttons">
          <div class="icon-button clickable no-hover-enlarge">
            <fa-icon [icon]="faLink" (click)="copyCalendarUrlToClipboard(cal.id)"></fa-icon>
          </div>
          <fa-icon (click)="onClickUnsubscribe(cal.id)" *ngIf="authService.isLoggedIn()" [icon]="faBookmark"
                   class="subscribed clickable no-hover-enlarge">Unsubscribe
          </fa-icon>
          <fa-icon *ngIf="cal.canEdit" [icon]="faCog" class="clickable no-hover-enlarge"
                   routerLink="/form/calendar/{{cal.id}}">
            Edit Calendar
          </fa-icon>
          <fa-icon *ngIf="cal.canEdit" (click)="delete(cal.id)" [icon]="faTimesCircle"
                   class="clickable no-hover-enlarge">
            Remove Calendar
          </fa-icon>
        </div>
      </div>
    </div>
    <div *ngIf="authService.isLoggedIn() && managedCalendars.length!==0 && !searchActive">
      <h3>Calendars Managed by me</h3>
      <div *ngFor="let cal of this.managedCalendars">
        <div class="calendar">
          <img [ngClass]="getCalendarColor(cal.id)" alt="" class="avatar avatar-medium"
               src="{{globals.backendUri+cal.coverImageUrl}}">
          <div class="calendar-details clickable no-hover-enlarge" routerLink="/calendar/{{cal.id}}">
            <div>
              <div class="calendar-name">{{cal.name}}</div>
              <div class="calendar-description">{{cal.description}}</div>
            </div>
            <div>
              <div *ngFor="let orgId of cal.organizationIds">
                <div *ngIf="organizationsMap.get(orgId)" class="organization-info clickable no-hover-enlarge" routerLink="/organization/{{orgId}}">
                  <img alt="" class="avatar avatar-ultra-small" src="{{organizationsMap.get(orgId).coverImageUrl}}">
                  <div class="organization-name">{{organizationsMap.get(orgId).name}}</div>
                </div>
              </div>
            </div>
          </div>
          <div class="calendar-buttons">
            <div class="icon-button clickable no-hover-enlarge">
              <fa-icon [icon]="faLink" (click)="copyCalendarUrlToClipboard(cal.id)"></fa-icon>
            </div>
            <fa-icon (click)="onClickSubscribe(cal.id)" *ngIf="authService.isLoggedIn()" [icon]="faBookmark"
                     class="clickable no-hover-enlarge">Subscribe
            </fa-icon>
            <fa-icon *ngIf="cal.canEdit" [icon]="faCog" class="clickable no-hover-enlarge"
                     routerLink="/form/calendar/{{cal.id}}">
              Edit Calendar
            </fa-icon>
            <fa-icon *ngIf="cal.canEdit" (click)="delete(cal.id)" [icon]="faTimesCircle"
                     class="clickable no-hover-enlarge">
              Remove Calendar
            </fa-icon>
          </div>
        </div>
      </div>
    </div>
    <div *ngIf="otherCalendars.length > 0 && !searchActive">
      <div class="title-icon-button-combo">
        <h3>All Calendars</h3>
        <div class="icon-button clickable no-hover-enlarge">
          <fa-icon [icon]="faLink" (click)="copyAllCalendarsUrlToClipboard()"></fa-icon>
        </div>
      </div>
      <div *ngFor="let cal of otherCalendars">
        <div class="calendar">
          <img [ngClass]="getCalendarColor(cal.id)" alt="" class="avatar avatar-medium"
               src="{{globals.backendUri+cal.coverImageUrl}}">
          <div class="calendar-details clickable no-hover-enlarge" routerLink="/calendar/{{cal.id}}">
            <div class="clickable no-hover-enlarge" routerLink="/calendar/{{cal.id}}">
              <div class="calendar-name">{{cal.name}}</div>
              <div class="calendar-description">{{cal.description}}</div>
            </div>
            <div>
              <div *ngFor="let orgId of cal.organizationIds">
                <div *ngIf="organizationsMap.get(orgId)" class="organization-info clickable no-hover-enlarge" routerLink="/organization/{{orgId}}">
                  <img alt="" class="avatar avatar-ultra-small" src="{{organizationsMap.get(orgId).coverImageUrl}}">
                  <div class="organization-name">{{organizationsMap.get(orgId).name}}</div>
                </div>
              </div>
            </div>
          </div>
          <div class="calendar-buttons">
            <div class="icon-button clickable no-hover-enlarge">
              <fa-icon [icon]="faLink" (click)="copyCalendarUrlToClipboard(cal.id)"></fa-icon>
            </div>
            <fa-icon (click)="onClickSubscribe(cal.id)" *ngIf="authService.isLoggedIn()" [icon]="faBookmark"
                     class="clickable no-hover-enlarge">subscribe
            </fa-icon>
            <fa-icon *ngIf="cal.canEdit" [icon]="faCog" class="clickable no-hover-enlarge"
                     routerLink="/form/calendar/{{cal.id}}">
              Edit Calendar
            </fa-icon>
            <fa-icon *ngIf="cal.canEdit" (click)="delete(cal.id)" [icon]="faTimesCircle"
                     class="clickable no-hover-enlarge">
              Remove Calendar
            </fa-icon>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
